 
{% extends "base.html" %}
{% load static %}
{% load conversion_tags %}

{% block head %}

   {% include "bokeh.html" %}
   {% include "bokeh_widgets.html" %}
   <script type="text/javascript" src="{% static 'js/spectrum_detail.js' %}"></script>
   
{% endblock %}


{% block headertitle %}Light Curve: {{ lightcurve }} {% endblock %}


{% block content %}
   
   <div id="sidenav">
   <h2> All Lightcurves for <span class="nobreak">{{lightcurve.star.name}}</span> </h2>
   {% for inst, spectra in all_spectra.items %}
      <h3> {{ inst }} </h3>
      <ul>
      {% for spec in spectra %}
         {% if spec.id == spectrum.id %}
         <li> <a href={% url 'observations:spectrum_detail' project.slug spec.id %} class="active"> {{ spec.hjd|floatformat:3 }} - {{ spec.hjd|hjd2date }}</a> </li>
         {% else %}
         <li> <a href={% url 'observations:spectrum_detail' project.slug spec.id %}> {{ spec.hjd|floatformat:3 }} - {{ spec.hjd|hjd2date }}</a> </li>
         {% endif %}
      {% endfor %}
      </ul>
   {% endfor %}
   </div>

   <section class='data-section'>
   
   <div class="main-container-h border">
      
      {% if user.is_authenticated %}
      <i id="spectrumEditButton" class="material-icons button edit" title="edit" spectrum_id={{spectrum.pk}}>edit</i>
      {% endif %}
      
      <div class='header-item'>
      <h3 id="nameField"> {{ lightcurve }}</h3> 
      </div>
      
      <div class='header-item'>
      <p class="material-icons">star</p> 
      <h3><a href={% url 'systems:star_detail' project.slug lightcurve.star.pk %}>{{ lightcurve.star.name }}</a></h3>  
      </div>
      
      
      <div class='header-item'>
      {% if lightcurve.valid %}
      <i id="spectrum-valid-icon" class="material-icons status-icon valid bold" title='Good quality'></i>
      {% else %}
      <i id="spectrum-valid-icon" class="material-icons status-icon invalid bold" title='Bad quality'></i>
      {% endif %}
      <h3> Valid</h3> 
      </div>
      
      
   </div>

<!--    <h3>Observing Information</h3> -->
   
   <div class="flex-data-container j-center">
   
   <div class="tag-container">
   <h3>Basic Data </h3>
   
   <div class="block">
   <div class="block">
   <table class='datatable'>
   <tbody>
      <tr> <th>Target:</th> <td class="mono">{{ lightcurve.objectname }}</td> </tr>
      <tr> <th>Target Coord.:</th> <td class="mono">{{ lightcurve.star.ra|dgr2hms }}  {{ lightcurve.star.dec|dgr2dms }}</td> </tr>
      <tr> <th>Obs. Coord.:</th> <td class="mono">{{ lightcurve.ra|dgr2hms }}  {{ lightcurve.dec|dgr2dms }}</td> </tr>
      <tr> <th>HJD:</th> <td class="mono">{{ lightcurve.hjd }}</td> </tr>
      <tr> <th>Date:</th> <td class="mono">{{ lightcurve.hjd|hjd2datetime }}</td> </tr>
      <tr> <th>Exposure:</th> <td class="mono">{{ lightcurve.exptime }}s</td> </tr>
      <tr> <th>Instrument:</th> <td class="mono">{{ lightcurve.instrument }} @ {{ lightcurve.telescope }}</td> </tr>
   </tbody>
   </table>
   </div>
   
   <div class="block">
   <table class='datatable'>
   <tbody>
      <tr> <th>Airmass:</th> <td class="mono">{{ lightcurve.airmass}}</td> </tr>
      <tr> <th>Moon Illumination:</th> <td class="mono">{{ lightcurve.moon_illumination }} &#37</td> </tr>
      <tr> <th>Moon Separation:</th> <td class="mono">{{ lightcurve.moon_separation }}&deg;</td> </tr>
      <tr> <th>Wind speed:</th> <td class="mono">{{ lightcurve.wind_speed }} km/h</td> </tr>
      <tr> <th>Wind direction:</th> <td class="mono">{{ lightcurve.wind_direction }}&deg; ({{ lightcurve.wind_direction|dgr2cardinal }})</td> </tr>
      <tr> <th>Observer:</th> <td class="mono">{{ lightcurve.observer}}</td> </tr>
      <tr> <th>Weather link:</th> <td class="mono"> <a target="_blank" href="{{ lightcurve.get_weather_url }}"> {{ lightcurve.observatory.short_name }} </a></td> </tr>
   </tbody>
   </table>
   </div>
   </div>
   
   
   </div>
   
   <div class="tag-container">
      <h3>Visibility</h3>
      <div class='block'>
      {{ figures.visibility|safe }}
      </div>
   </div>
   
   <div class="tag-container">
      
      <h3>
      Note  
      {% if user.is_authenticated %}
         (<i id="noteEditButton" class="material-icons button inline-icon" title="edit" spectrum_id={{spectrum.pk}}>edit</i>)
      {% endif %}
      </h3>
      
      <div id="noteField">{{spectrum.note|linebreaks}}</div>
      
   </div>
   
   </div>
   
   <hr>
   
   </section>
   
   <section class='data-section'>

   <!--<h3>The Spectrum</h3>
   
   <p>The spectrum is shifted with a barycentric correction of {{spectrum.barycor}} km/s.</p>-->
   
   <div class="flex-data-container">
   
   {% if figures.spec %}
<!--    <div class="block w1100"> -->
      {{ figures.spec|safe }}
<!--    </div> -->
   {% endif %} 
   
   </div>
   
   <hr>
   
   </section>
   
   <div id="headerWindow">
      <ul id="headerList">
      </ul>
   </div>
   
   {{ script|safe }}
   
   
   <!-- Div ect necessary for editing on page stuff with ajax -->
   <div id="noteEdit" title="Edit spectrum Note">
      <textarea name="edit-message" id="edit-message" cols="80" rows="5"></textarea>
   </div>
   
   <div id="spectrumEdit" title="Edit lightcurve">
   
      <ul>
         <li>
         <label for="lightcurve-valid">
         <input type="checkbox" id="lightcurve-valid" lightcurve_id="{{lightcurve.pk}}">
         Valid </label>
         </li>
         
         <li>
         <label for="lightcurve-fluxunits"> Exposure Time: 
         <input id="lightcurve-exptime" type='text' size="100">
         </label>
         </li>
         
         <li>
         <label for="lightcurve-fluxunits"> Cadence: 
         <input id="spectrum-fluxunits" type='text' size="100">
         </label>
         </li>
      </ul>
   </div>

{% endblock %}
